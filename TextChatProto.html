<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Interface</title>
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>
<body x-data class="bg-black h-screen h-full" :style="{ color: $store.app.theme.mainText}">
    <div id="chat-container" class="w-full max-w-[600px] h-full bg-slate-50 mx-auto flex flex-col overflow-auto">
        <header x-data id="chat-header" class="flex flex-row flex-none" :style="{ backgroundColor: $store.app.theme.headerBg, color: $store.app.theme.headerText}">
            <!-- Back Arrow, Profile Pic and Contact Name -->
            <button class="w-14" id="backArrow"><span class="material-symbols-outlined">
                arrow_back
            </span></button>
            <img id="contactImg" class="flex-none rounded-full p-2" src="contact.png" alt="Contact Image" width="64" height="64">
            <input type="text" id="contact-name" class="pl-3 text-lg font-medium outline-none bg-transparent flex-auto" autocomplete="off" spellcheck="false"></input>

            <!-- Not Visible -->
            <input type="file" id="contactImageInput" accept="image/*" style="display: none;">
            <!-- Call and Menu -->
            <div class="flex flow-row flex-none pr-3">
                <button id="call" class="w-11"><span class="material-symbols-outlined">
                    call
                </span></button>
                <button id="menu" class="w-11"><span class="material-symbols-outlined">
                    menu
                </span></button>
            </div>
        </header>
        <div x-data id="chatBody" class="flex flex-col flex-1 overflow-y-scroll relative p-2.5" :style="{ backgroundColor: $store.app.theme.bodyBg }">
            <!-- Chat messages will be appended here -->
            <template x-for="message in $store.app.chatMessages">
                <div x-data class="px-2 py-2 rounded-2xl w-max max-w-80 min-h-max mb-px inline-block text-pretty relative text-xs overflow-clip"
                :class="message.type === 'sent' ? 'chat-bubble sent' : 'chat-bubble received'">
                    <template x-if="message.messageType === MessageType.IMG">
                        <img x-bind:src="message.content" alt="">
                    </template>
                    <template x-if="message.messageType === MessageType.WAV">
                        <img src="" alt="">
                    </template>
                    <template x-if="message.messageType === MessageType.MSG">
                        <span x-text="message.content"></span>
                    </template>
                </div>
            </template>

            <!-- Scroll up and down arrows -->
            <div class="opacity-20">
                <div id="upArrow" class="fixed w-8 h-8 leading-7 text-center bg-black text-white cursor-pointer z-10 bottom-14 inset-x-1/2 -translate-x-2/4 rounded-full">&uarr;</div>
                <div id="downArrow" class="fixed w-8 h-8 leading-7 text-center bg-black text-white cursor-pointer z-10 top-20 inset-x-1/2 -translate-x-2/4 rounded-full">&darr;</div>
            </div>
        </div>
        <footer x-data id="chat-footer" class="flex flex-row flex-none h-13 p-1" :style="{ backgroundColor: $store.app.theme.bodyBg }">
            <button x-data id="smileButton" class="w-11 py-auto material-symbols-outlined flex-none rounded-l-full" :style="{ backgroundColor: $store.app.theme.headerBg }">
                sentiment_satisfied
            </button>

            <input type="text" id="messageInput" class="h-11 pl-2 flex-auto outline-none bg-transparent" placeholder="Text message"  :style="{ backgroundColor: $store.app.theme.headerBg }">

            <button id="audioButton" class="w-11 py-auto material-symbols-outlined" :style="{ backgroundColor: $store.app.theme.headerBg }">
                mic
            </button>
            <button id="imageButton" class="w-11 py-auto material-symbols-outlined rounded-r-full pr-2 mr-1" :style="{ backgroundColor: $store.app.theme.headerBg }">
                image_search
            </button>

            <button id="sendButton" class="w-11 py-auto material-symbols-outlined rounded-full" :style="{ backgroundColor: $store.app.theme.headerBg }">
                send
            </button>

            <!-- Not Visible -->
            <input type="file" id="imageInput" accept="image/*" style="display: none;">
            <input type="file" id="audioInput" accept="sound/*" style="display: none;">
            <input type="file" id="jsonInput" accept="json/.cht" style="display: none;">
        </footer>
    </div>
    <div x-data
        x-show="$store.app.error.show"
        id="errorModal"
        class="fixed z-1000 left-0 top-0 w-full h-full overflow-auto bg-black/50 justify-center items-center flex"
        style="display:none"
        @click="$store.app.error.show = false">
        <div id="error-modal-content" class="bg-gray-500 text-white rounded-lg m-auto p-8 border border-color-slate-500 w-4/5 max-w-4/5 relative">
            <span id="error-close-button" @click="$store.app.error.show = false" class="float-right text-2xl cursor-pointer font-bold hover:text-black">&times;</span>
            <h2>JavaScript Error</h2>
            <pre x-text="$store.app.error.text"></pre>
        </div>
    </div>
    <script src="scripts.js"></script>
</body>
</html>